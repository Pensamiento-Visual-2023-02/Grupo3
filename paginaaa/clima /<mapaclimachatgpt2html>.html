<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chile Map</title>
    <!-- Include D3.js library -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        /* Add any necessary CSS styles here */
    </style>
</head>
<body>
    <!-- Add a container div for the map -->
    <div id="map-container"></div>
    <!-- Add a label for displaying region names -->
    <div id="label"></div>
    <script>
        // Define the D3.js code
        const width = 700;
        const height = 580;

        const svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const chileProjection = d3.geoAlbers()
            .scale(600)
            .rotate([71.542969, 0])
            .center([0, -35.675147])
            .translate([width / 2, height / 2]);

        const chileGeoPath = d3.geoPath()
            .projection(chileProjection);

        const g = svg.append("g");
        const temperaturas = svg.append("g");

        // Load the Chile GeoJSON data
        d3.json('https://raw.githubusercontent.com/fcortes/Chile-GeoJSON/master/Regional.geojson')
            .then(regioneschile => {
                g.selectAll("path")
                    .data(regioneschile.features)
                    .enter()
                    .append("path")
                    .attr("fill", "#ccc")
                    .attr("stroke", "#333")
                    .attr("d", chileGeoPath);
            })
            .catch(error => console.error('Error loading Chile GeoJSON data:', error));

        // Load the temperature data for Chile
        d3.json('https://climatologia.meteochile.gob.cl/application/servicios/getEstacionesRedEma?usuario=correo@correo.cl&token=apiKey_personal')
            .then(temperaturaData => {
                temperaturas.selectAll("path")
                    .data(temperaturaData.features)
                    .enter()
                    .append("path")
                    .attr("fill", "#900")
                    .attr("stroke", "#999")
                    .attr("d", chileGeoPath)
                    .attr("class", "incident")
                    .on("mouseover", d => d3.select("#label").text(d.properties.NombreRegion))
                    .on("mouseout", d => d3.select("#label").text(""));
            })
            .catch(error => console.error('Error loading temperature data:', error));
    </script>
</body>
</html>
